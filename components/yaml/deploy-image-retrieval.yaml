kind: remote
metadata:
  name: latest-image-retrieve
  tag: ''
  hash: ed20ec2bcca001eb5c4aa7898cec6226c3b54117
  project: default
spec:
  command: ''
  args: []
  image: ''
  entry_points:
    seek_location:
      name: seek_location
      doc: ''
      parameters:
      - name: context
        default: ''
      - name: shardId
        type: int
        default: 0
      - name: container
        type: str
        default: ''
      - name: stream
        type: str
        default: ''
      - name: url
        default: ''
      - name: secondsLapsed
        default: 1
      outputs:
      - default: ''
      lineno: 14
    get_image:
      name: get_image
      doc: ''
      parameters:
      - name: context
        default: ''
      - name: url
        default: ''
      - name: shardId
        default: ''
      - name: container
        default: ''
      - name: stream
        default: ''
      - name: secondsLapsed
        default: ''
      outputs:
      - default: ''
      lineno: 30
    handler:
      name: handler
      doc: ''
      parameters:
      - name: context
        default: ''
      - name: event
        default: ''
      outputs:
      - default: ''
      lineno: 53
  description: ''
  min_replicas: 1
  max_replicas: 1
  env:
  - name: V3IO_ACCESS_KEY
    value: ''
  - name: IGZ_CONTAINER
    value: bigdata
  - name: RAW_VIDEO_STREAM
    value: videostream
  - name: TAGGED_VIDEO_STREAM
    value: taggedvideos
  - name: CAMERA_LIST_TBL
    value: camera_list
  - name: GET_IMAGE_FUNCTION
    value: latest-image-retrieve
  config:
    spec.triggers.http:
      kind: http
      maxWorkers: 1
      attributes:
        ingresses: {}
      annotations: {}
  base_spec:
    apiVersion: nuclio.io/v1
    kind: Function
    metadata:
      annotations:
        nuclio.io/generated_by: function generated from 27-10-2020 by nicks
      labels: {}
      name: latest-image-retrieve
    spec:
      build:
        commands: []
        functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCBqc29uCmltcG9ydCBiYXNlNjQKaW1wb3J0IG9zCmltcG9ydCB0aW1lCgpoZWFkZXJzID0gewogICAgICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgICAgICAiWC12M2lvLXNlc3Npb24ta2V5IiA6IG9zLmdldGVudigiVjNJT19BQ0NFU1NfS0VZIikKICAgICAgICAgIH0KCmRlZiBzZWVrX2xvY2F0aW9uKGNvbnRleHQsCiAgICAgICAgICAgICAgICAgIHNoYXJkSWQ6IGludCA9IDAsCiAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogc3RyID0gJycsCiAgICAgICAgICAgICAgICAgIHN0cmVhbTogc3RyID0gIiIsCiAgICAgICAgICAgICAgICAgIHVybCA9ICcnLAogICAgICAgICAgICAgICAgIHNlY29uZHNMYXBzZWQgPSAxKToKICAgIHBheWxvYWQgPSB7CiAgICAgICAgICAgICJTaGFyZElkIjogc2hhcmRJZCwKICAgICAgICAgICAgIlR5cGUiOiAiVElNRSIsCiAgICAgICAgIlRpbWVzdGFtcFNlYyI6aW50KHRpbWUudGltZSgpKS1zZWNvbmRzTGFwc2VkLAogICAgICAgICJUaW1lc3RhbXBOU2VjIiA6IDAKICAgICAgICAgIH0KICAgIGhlYWRlcnNbIlgtdjNpby1mdW5jdGlvbiJdID0gIlNlZWsiCiAgICByID0gcmVxdWVzdHMucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycyxqc29uPXBheWxvYWQpCiAgICByZXR1cm4ganNvbi5sb2FkcyhyLnRleHQpWydMb2NhdGlvbiddCgpkZWYgZ2V0X2ltYWdlKGNvbnRleHQsCiAgICAgICAgICAgICAgdXJsLAogICAgICAgICAgICAgIHNoYXJkSWQsCiAgICAgICAgICAgICAgY29udGFpbmVyLAogICAgICAgICAgICAgIHN0cmVhbSwKICAgICAgICAgICAgICBzZWNvbmRzTGFwc2VkKToKICAgIGxvY2F0aW9uID0gc2Vla19sb2NhdGlvbihjb250ZXh0LHNoYXJkSWQ9c2hhcmRJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXI9Y29udGFpbmVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmVhbT1zdHJlYW0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsPXVybCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZHNMYXBzZWQgPSBzZWNvbmRzTGFwc2VkKQogICAgaW1nX3BheWxvYWQgPSB7CiAgICAgICAgICAgICJTaGFyZElkIjogICAgc2hhcmRJZCwKICAgICAgICAgICAgIkxvY2F0aW9uIjogICBsb2NhdGlvbiwKICAgICAgICAiTGltaXQiOjEKICAgIH0KICAgIGhlYWRlcnNbIlgtdjNpby1mdW5jdGlvbiJdID0gIkdldFJlY29yZHMiCiAgICByID0gcmVxdWVzdHMucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycyxqc29uPWltZ19wYXlsb2FkKQogICAgCiAgICByZXNwb25zZT1qc29uLmxvYWRzKHIudGV4dCkKICAgIAogICAgcmV0dXJuIHJlc3BvbnNlCgpkZWYgaGFuZGxlcihjb250ZXh0LCBldmVudCk6CiAgICBwYXJhbXMgPSBldmVudC5maWVsZHMKICAgIHNoYXJkSWQ9aW50KHBhcmFtc1snc2hhcmRJZCddKQogICAgY29udGFpbmVyPXBhcmFtc1snY29udGFpbmVyJ10KICAgIHN0cmVhbT1wYXJhbXNbJ3N0cmVhbSddCiAgICAKICAgIHVybCA9ICJodHRwOi8vdjNpby13ZWJhcGk6ODA4MS8lcy8lcy8iJSAoY29udGFpbmVyLHN0cmVhbSkKICAgIGhlYWRlcnMgPSB7ICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgICAgICJYLXYzaW8tc2Vzc2lvbi1rZXkiIDogb3MuZ2V0ZW52KCJWM0lPX0FDQ0VTU19LRVkiKQogICAgfQoKICAgIHNlY29uZHNMYXBzZWQgPSAxCiAgICB3aGlsZSBUcnVlOgogICAgICAgICAgcmVzcG9uc2UgPSBnZXRfaW1hZ2UoY29udGV4dCx1cmwsc2hhcmRJZCxjb250YWluZXIsc3RyZWFtLHNlY29uZHNMYXBzZWQgKQogICAgICAgICAgZGF0YSA9IEZhbHNlICAKICAgICAgICAgIGZvciByZWNvcmQgaW4gcmVzcG9uc2VbJ1JlY29yZHMnXToKICAgICAgICAgICAgICAgIGRhdGEgPSBiYXNlNjQuYjY0ZGVjb2RlKHJlY29yZFsnRGF0YSddKSAKICAgICAgICAgIGlmIGRhdGE6CiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgIHNlY29uZHNMYXBzZWQgKz0gMQogICAgCiAgICByZXR1cm4gZGF0YQoK
        noBaseImagesPull: true
        baseImage: docker-registry.default-tenant.app.nicks-dev-cluster.iguazio-cd2.com:80/facial-recognition-demo-image
      env: []
      handler: DeployImageRetrieval:handler
      runtime: python:3.6
      volumes: []
      loggerSinks:
      - level: info
  source: ''
