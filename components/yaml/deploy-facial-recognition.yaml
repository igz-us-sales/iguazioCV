kind: remote
metadata:
  name: deploy-facial-recognition
  tag: ''
  hash: faa0773c31335815922b3d9ff8be5c49c1aaa782
  project: facial-recognition-demo
spec:
  command: ''
  args: []
  image: ''
  entry_points:
    stream_frame_write:
      name: stream_frame_write
      doc: ''
      parameters:
      - name: context
        default: ''
      - name: frame
        default: ''
      - name: shard
        default: ''
      outputs:
      - default: ''
      lineno: 11
    handler:
      name: handler
      doc: ''
      parameters:
      - name: context
        default: ''
      - name: event
        default: ''
      outputs:
      - default: ''
      lineno: 29
  description: ''
  min_replicas: 1
  max_replicas: 1
  env:
  - name: V3IO_API
    value: ''
  - name: V3IO_USERNAME
    value: ''
  - name: V3IO_ACCESS_KEY
    value: ''
  - name: IGZ_CONTAINER
    value: bigdata
  - name: ROTATE_180
    value: 'True'
  config:
    spec.triggers.http:
      kind: http
      maxWorkers: 1
      attributes:
        ingresses: {}
      annotations: {}
    spec.triggers.image-proc:
      kind: v3ioStream
      url: http://v3io-webapi:8081/bigdata/facial-recognition-demo/videostream@processorgrp
      password: 20a362b3-84cf-4222-9d8e-a06a5a5cb518
      attributes:
        pollingIntervalMs: 500
        seekTo: earliest
        readBatchSize: 100
        partitions: 0-100
  base_spec:
    apiVersion: nuclio.io/v1
    kind: Function
    metadata:
      annotations:
        nuclio.io/generated_by: function generated from 27-10-2020 by nicks
      labels: {}
      name: deploy-facial-recognition
    spec:
      build:
        commands: []
        functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKaW1wb3J0IGN2Mgpmcm9tIGN2MiBpbXBvcnQgVmlkZW9Xcml0ZXJfZm91cmNjLCBWaWRlb1dyaXRlcgppbXBvcnQgc3lzCmltcG9ydCBvcwppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IGJhc2U2NAppbXBvcnQgbnVtcHkgYXMgbnAKCmRlZiBzdHJlYW1fZnJhbWVfd3JpdGUoY29udGV4dCxmcmFtZSxzaGFyZCk6CiAgICBoZWFkZXJzID0gewogICAgICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgICAgICAiWC12M2lvLWZ1bmN0aW9uIjogIlB1dFJlY29yZHMiLAogICAgICAgICAgICAiWC12M2lvLXNlc3Npb24ta2V5IiA6IG9zLmdldGVudigiVjNJT19BQ0NFU1NfS0VZIikKICAgICAgICAgIH0KICAgIGRhdGEgPSBiYXNlNjQuYjY0ZW5jb2RlKGZyYW1lKQogICAgcGF5bG9hZCA9IHsKICAgICAgICAgICAgIlJlY29yZHMiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIkRhdGEiOiAgZGF0YS5kZWNvZGUoJ3V0Zi04JyksCiAgICAgICAgICAgICAgICAgICAgIlNoYXJkSWQiIDogc2hhcmQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBdCiAgICAgICAgICB9CiAgICByID0gcmVxdWVzdHMucG9zdChvcy5nZXRlbnYoIlRBR0dFRF9WSURFT19TVFJFQU1fVVJMIiksIGhlYWRlcnM9aGVhZGVycyxqc29uPXBheWxvYWQpICAgCiAgICByZXR1cm4gci50ZXh0CgpkZWYgaGFuZGxlcihjb250ZXh0LCBldmVudCk6CiAgICBzaGFyZElkID0gZXZlbnQuc2hhcmRfaWQKICAgIGV2ZW50X2RhdGE9ZXZlbnQuYm9keQogICAgCiAgICBmYWNlX2Nhc2NhZGUgPSBjdjIuQ2FzY2FkZUNsYXNzaWZpZXIoY3YyLmRhdGEuaGFhcmNhc2NhZGVzICsgJ2hhYXJjYXNjYWRlX2Zyb250YWxmYWNlX2RlZmF1bHQueG1sJykKCiAgICBpbWcgPSBldmVudF9kYXRhCiAgICBpbWcgPSBucC5mcm9tYnVmZmVyKGltZywgZHR5cGU9bnAudWludDgpCiAgICBpbWcgPSBjdjIuaW1kZWNvZGUoaW1nLCBmbGFncz0xKQogICAgaWYgYm9vbChvcy5nZXRlbnYoJ1JPVEFURV8xODAnKSk6CiAgICAgICAgaW1nID0gY3YyLnJvdGF0ZShpbWcsIGN2Mi5ST1RBVEVfMTgwKSAjIEZvciBzb21lIHJlYXNvbiBteSBzdHJlYW0gaXMgZmxpcHBlZD8KICAgIGNvbnRleHQubG9nZ2VyLmluZm8oaW1nLnNoYXBlKQogICAgCiAgICBmYWNlcyA9IGZhY2VfY2FzY2FkZS5kZXRlY3RNdWx0aVNjYWxlKGltZywgMS4xLCA0KQogICAgCiAgICBmYWNlX2NvdW50PTAKICAgIGZvciAoeCwgeSwgdywgaCkgaW4gZmFjZXM6CiAgICAgICAgZmFjZV9jb3VudCArPSAxCiAgICAgICAgY3YyLnJlY3RhbmdsZShpbWcsICh4LCB5KSwgKHggKyB3LCB5ICsgaCksICgyNTUsIDAsIDApLCAyKQogICAgICAgIAogICAgY29udGV4dC5sb2dnZXIuaW5mbygiRmFjZSBDb3VudDogJXMiJSBmYWNlX2NvdW50ICkKICAgIGlmIGZhY2VfY291bnQgPiAwIDoKICAgICAgICByZXQsIGJ1ZmZlciA9IGN2Mi5pbWVuY29kZSgnLmpwZycsIGltZykKICAgICAgICB0cnk6CiAgICAgICAgICAgIHIgPSBzdHJlYW1fZnJhbWVfd3JpdGUoY29udGV4dCxidWZmZXIudG9ieXRlcygpLHNoYXJkSWQpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBjb250ZXh0LmxvZ2dlci5lcnJvcigiRmFpbGVkIHRvIHNhdmUgZnJhbWUgZm9yIHNoYXJkICVzIiUgc2hhcmRJZCkKCg==
        noBaseImagesPull: true
        baseImage: docker-registry.default-tenant.app.nicks-dev-cluster.iguazio-cd2.com:80/facial-recognition-demo-image
      env: []
      handler: DeployFacialRecognition:handler
      runtime: python:3.6
      volumes: []
      loggerSinks:
      - level: info
  source: ''
